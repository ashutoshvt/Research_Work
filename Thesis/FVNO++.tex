%\documentclass[journal=jpccck,manuscript=article]{achemso}
%\usepackage[numbers,super]{natbib}
%
%\usepackage{graphicx}
%\usepackage{xcolor}
%\usepackage{todonotes}
%
%\def\ket#1{| #1 \rangle}
%\def\bra#1{\langle #1 |}
%
%\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)
%\usepackage{verbatim}
%\usepackage{amsfonts}
%\usepackage{graphicx}
%\newcommand{\overbar}[1]{\mkern 2.2mu\overline{\mkern-2.2mu#1\mkern-2.2mu}\mkern 2.2mu}
%\usepackage{multirow}
%\usepackage{array}
%\usepackage{varwidth}
%\usepackage{bm}
%
%\title{Frozen Virtual Natural Orbitals ++ for Coupled Cluster Linear-Response Theory}
%\author{Ashutosh Kumar}
%\affiliation{Department of Chemistry, Virginia Tech, Blacksburg, Virginia 24061, U.S.A.}
%\author{T.\ Daniel Crawford}
%\email{crawdad@vt.edu}
%\affiliation{Department of Chemistry, Virginia Tech, Blacksburg, Virginia 24061, U.S.A.}
%
%\date{\today}
%
%\begin{document}
%
%\begin{abstract} We present here the the modified frozen-virtual natural-orbital (NO) 
%approach, which we call FVNO++ for a compact representation of the 
%response of the coupled cluster wavefunction to external electric
%and magnectic fields. In our earlier work,\cite{Kumar17}
%we showed that the regular FVNO method performs rather poorly for 
%%The frozen-virtual natural-orbital (NO) approach, whereby the
%%unoccupied-orbital space is constructed using a correlated density such as
%%that from many-body perturbation theory, has proven to yield compact wave
%%functions for determining ground-state correlation energies and associated
%%properties, with corresponding occupation numbers providing a guide to the
%%truncation of the virtual space.  In this work this approach is tested for the
%%first time for the calculation of higher-order response properties,
%%particularly frequency-dependent dipole polarizabilities using coupled-cluster
%%theory.  We find that such properties are much more sensitive to the
%%truncation of virtual space in the natural orbital (NO) basis than in the
%%original canonical molecular orbital (CMO) basis, with truncation errors
%%increasing linearly with respect to the number of frozen virtual NOs.  The
%%reasons behind this poor performance include the more diffuse nature of NOs
%%with low occupation numbers as well as the reduction in sparsity of the
%%perturbed singles amplitudes in the NO basis and the neglect of orbital
%%response.  We tested a number of approaches
%%to improve the performance of the NO space, including the use of a
%%field-perturbed density to define the virtual orbitals and various
%%external-space corrections.  The truncation of the CMO space, on the other
%%hand, yields errors in coupled-cluster dipole polarizabilities of less than
%%2\% even after removing as much as 50\% of the full virtual space. We find
%%that this positive performance of the CMO space results from a cancellation of
%%errors due to the truncation of the unperturbed and perturbed amplitudes, as
%%well as sparsity of the singles amplitudes.  We introduce a simple criterion
%%called a dipole amplitude to use as a threshold for truncating the CMO basis
%%for such property calculations.  \end{abstract}
%\end{abstract}
%\maketitle

\section{Introduction}

One of the central problems limiting the application of accurate {\em ab
initio} methods like coupled-cluster (CC) theory to large molecular systems is their high 
computational costs, i.e., their computing and storage requirements 
exhibit polynomial scaling with the size of the system or equivalently
with the number of one electron basis functions used in these calculations.
Specifically, the size of the virtual space is of greater concern since  
they usually far outnumber the occupied orbitals. Furthermore, the canonical virtual orbitals
obtained from the Hartree-Fock (HF) procedure are quite de-localized and hence 
the convergence of a determinantal expansion involving these orbitals
is quite slow. However, L{\"o}wdin \cite{}showed that using 
``natural orbitals'' (NOs) instead of canonical HF orbitals can significantly 
accelerate the convergence of the configuration interaction (CI)
wavefunction expansion. The NOs are the eigenvectors of the 
1 electron reduced density matrix (1-RDM) associated with a wavefunction. 
The corresponding eigenvalues are commonly referred to 
as ``occupation numbers''. Since L{\"o}wdin's pioneering 
work, NOs have found a lot of applications especially in techniques 
aimed at obtaining a compact representation of the virtual space for 
correlated calculations.\cite{} Within the context of the CC theory,
the frozen virtual NO (FVNO) scheme where the NOs are usually obtained from 
the 1-RDM of a less expensive correlated method such as second-order 
M{\"o}ller-Plesset (MP2) theory and the virtual space for subsequent 
CC calculations is truncated based on the orbitals' occupation 
numbers has been used quite successfully to calculate correlation energies, 
ionization enthalpies etc\cite{}. For example, Landau et al.\cite{} demonstrated 
that even after the removal of 70\% of the virtual space, the errors in
the ionization energies of organic compounds were less than 1 kcal/mol.
However, it has been well established from previous studies that response 
properties are usually much more sensitive to the truncation of the wavefunction 
than simple energetics\cite{}. So we investigated the applicability of such 
approaches for properties like dynamic polarizabilities using CC linear reponse theory
\cite{}. In contrast to the earlier studies, we got huge errors in polarizabilities 
which increased almost linearly with the number of truncated virtual orbitals. 
It was found that the ground-state MP2 density used to generate the NOs was 
unable to capture the response of the wavefunction to the external field. 
For example, the FVNO procedure threw out first, the diffuse virtual 
orbitals which are very important to describe the low lying Rydberg type 
excited states (a common feature in majority of chiral compounds) 
resulting in large errors. This was not unsurprising since these diffuse 
orbitals have very low contributions to the correlation energy and hence 
possess very low occupation numbers. Consistent with the findings of Sundholm 
and co-workers\cite{Sundholm13}, dropping high energy canonical HF 
virtual orbitals led to very small errors in polarizabilities. 
We also constructed a first-order perturbed MP2 density hoping that 
the ONs obtained from this density would be a better metric for 
estimating the importance of a virtual orbital 
for response properties but this approach only offered
minor improvements over the regular FVNO method. However, 
a suite of methods, conceptually not very different from our 
perturbed density approach have been proposed recently 
to calculate CC excitation energies. Baudin and co-workers 
used natural transition orbitals (NTOs) obtained from approximate 
CIS(D) transition densities, a scheme which they call CorNFLEx for 
calculating CC2 excitation energies of large solvated formamide 
clusters\cite{}. In similar works, H{\"o}fener and Klopper 
obtained effective virtual spaces by combining MP2 
ground state density with excited state densities constructed from CIS 
excitation vectors\cite{} while Mester et al. used MP2 and CIS(D) amplitudes 
to define their optimal virtual and occupied spaces\cite{Mester17,Mester18}.
These successful works prompted us to take back a closer look at the 
reasons behind the failure of our perturbed density approach. 
Finally, we have developed a new method which we call FVNO++ 
where we construct a second-order perturbed density to 
capture the response of the wavefunction to the external electric 
and magnetic fields. In this paper, we look at some of the basis aspects of 
this method and report its performance in calculating CC dynamic 
polarizabilities and specific rotations of a number of chiral molecules .
\section{Theoretical Background}
%\subsection{Frozen Virtual Natural Orbitals}
%The MP2 unrelaxed one-electron density matrix can be written in terms of
%spin orbitals as: 
%\begin{equation}
%\gamma_{pq} = \langle \Psi^{(1)}|\{ a^{\dagger}_{p}a_q\}|\Psi^{(1)}\rangle,
%\label{Eq:density}
%\end{equation}
%where $|\Psi^{(1)}\rangle$ is the first order correction to the Hartree-Fock
%wave function,
%\begin{equation}
%|\Psi^{(1)}\rangle = \frac{1}{4}\sum_{ijab} t^{ab}_{ij}|\Phi^{ab}_{ij}\rangle
%\end{equation}
%and
%\begin{equation}
%t^{ab}_{ij} = \frac{\langle ij||ab\rangle}{\epsilon_i + \epsilon_j -
%\epsilon_a - \epsilon_b}.
%\end{equation}
%Here, $\langle ij||ab\rangle$ is an antisymmetrized two-electron integral in
%Dirac's notation and $\epsilon_i,\epsilon_a...$ refer to the Hartree-Fock
%molecular orbital energies. We use the indices $i,j,k,...$ to indicate occupied
%orbitals while $a,b,c,...$ denote virtual orbitals. $|\Phi^{ab}_{ij}\rangle$
%refers to a doubly-excited determinant where occupied orbitals $i$ and $j$ are
%replaced by virtuals $a$ and $b$ respectively.  The brackets around the
%second-quantized operators in Eq.~(\ref{Eq:density}) indicate normal ordering
%with respect to the reference wave function.
%
%In the MP2 based NO method, the virtual-virtual block of $\gamma_{pq}$
%is constructed,
%\begin{equation}
%\gamma_{ab} = \frac{1}{2}\sum_{ijc} t^{ac}_{ij}t^{bc}_{ij},
%\label{Eq:dens}
%\end{equation}
%and then diagonalized,
%\begin{equation}
%\bm{\gamma} \bm{V} = \bm{n} \bm{V}.
%\end{equation}
%The eigenvectors, $\bm{V}$, are the virtual natural orbitals (NOs), and the
%eigenvalues, $\bm{n}$, are the associated occupation numbers.  As noted
%earlier, the wave function amplitudes contain significantly greater sparsity
%when represented in the NO basis than the original canonical MO basis;
%orbitals with lower occupation numbers yield $\hat{T}_2$ amplitudes with
%smaller magnitudes and concomitantly smaller contributions to the correlation
%energy.  Thus, orbitals with occupation numbers below a selected threshold can
%be removed without introduction of significant errors, leading to reduced
%computational cost.  The Hartree-Fock virtual molecular orbitals and
%associated integrals are then transformed to this truncated NO basis, followed
%by semicanonicalization of the virtual-virtual block of the Fock matrix, for
%subsequent computations using higher-order correlation methods such as CC
%theory.  In most cases, the final correlation energy in the truncated virtual
%space is corrected using the MP2 energy in the external (non-truncated) NO
%space to minimize the resulting errors, as described belowa

\subsection{Coupled Cluster Response Theory}
The response functions for calculating dynamic higher-order properties 
are defined by the frequency dependent coefficients 
appearing in the expansion of the expectation value of an appropriate 
time-independent operator in orders of the perturbation.
\begin{equation}
A(t) = \langle \Psi^{(0)} | \hat{A} | \Psi^{(0)} \rangle \
+ \langle \Psi^{(1)}(t) | \hat{A} | \Psi^{(0)} \rangle\
+ \langle \Psi^{(0)} | \hat{A} | \Psi^{(1)}(t) \rangle\ 
+ \langle \Psi^{(1)}(t) | \hat{A} | \Psi^{(1)}(t) \rangle + ... \\
\end{equation}
For example, the linear reponse function ${\langle\langle A;B\rangle\rangle}_{\omega_1} $ 
can be seen as the first order change in the expectation value of $\hat{A}$ in 
the time-dependent field parametrized by the operator $B$,
\begin{equation}
\int_{-\infty}^{\infty}d\omega_1{\langle\langle A;\
B\rangle\rangle}_{\omega_1 + i\alpha}e^{(-i\omega_1 + \alpha)t} \
= \langle \Psi^{(1)}(t) | \hat{A} | \Psi^{(0)} \rangle\
+ \langle \Psi^{(0)} | \hat{A} | \Psi^{(1)}(t) \rangle\
\end{equation}
One can obtain electric-electric ($\alpha$) and electric-magnetic ($\beta$)
dipole polarizability tensors from the linear response function with appropriate
operators,
\begin{equation}
\alpha_{xy}(\omega) = {\langle\langle \mu_x;\mu_y\rangle\rangle}_{\omega_1}
\end{equation}
\begin{equation}
\beta_{xy}(\omega) = {-\text{Im} \langle\langle \mu_x;m_y\rangle\rangle}_{\omega_1}
\end{equation}
where $\mu = \sum_i q_i r_i $ and $m = \sum_i \frac{q_i}{2m_i} r_i \times p_i$. 
One-third of the trace of the $\alpha$ tensor is the isotropic 
electric dipole polarizability. Specific rotation on the other hand 
is related to the one-third of the trace of the $\beta$ tensor (au) 
also known as the Rosenfeld tensor by the following expression\cite{},
\begin{equation}
{\lbrack\alpha\rbrack}_{\omega} = \frac{(72.0 \times 10^6){\hbar}^2 N_A\;\omega}\
{c^2{m_e}^2 M} \times \left[ \frac{1}{3}Tr(\beta)\right]
\end{equation}
where M is the mass of the molecule (amu), $m_e$ is the rest mass of an electron
(kg), c is the speed if light in vacuum (m/s), $N_A$ is Avogadro's number and $\omega$
is the frequency of the electromagnetic field (au). \\
The coupled cluster linear response function can be written as\cite{}: 
\begin{equation}
{\langle\langle A;B\rangle\rangle}_{\omega_1} =  \langle \Psi_0 | \
[\hat{Y}^{B}_{\omega_1}, \bar{A}]|\Psi_0\rangle + \langle \Psi_0 | \
(1 + \hat{\Lambda})|[\bar{A},\hat{X}^{B}_{\omega_1}]|\Psi_0\rangle 
\end{equation}
where $A$ and $B$ are the one electron property operators,
$\omega_1$ is the frequency of the external field, 
$\Psi_0$ is the reference wavefunction, $\hat{\Lambda}$ is 
a linear de-excitation operator that parametrizes the CC left hand 
wavefunction to make sure that the CC gradients satisfy the 
generalized Hellman-Feynman theorem\cite{}, $\bar{A}$ is the 
similarity transformed $\hat{A}$ operator $\hat{A}$, $\bar{A} = e^{-\hat{T}}\hat{A}e^{\hat{T}}$,
$\hat{X}^{B}_{\omega_1}$ and $\hat{Y}^{B}_{\omega_1}$ are the first-order 
perturbed right and left hand amplitudes corresponding to perturbation operator 
$B$ respectively. 
\subsection{Perturbed Natural Orbitals}
The CC linear response function (eq. ) can also be formulated in terms of densities,
\begin{equation}
{\langle\langle A;B\rangle\rangle}_{\omega_1} =  \sum_{pq} A_{pq}D^{B}_{pq}(\omega_1)
\end{equation}
where $D^{B}(\omega_1)$ is the frequency dependent first-order
perturbed one-electron density related to operator B. The structures  
of the virtual-virtual block of the perturbed densities for a given
perturbation operator can be easily identified in spin orbitals as,
\begin{equation}
\begin{split}
%\begin{multline}
& D^{(0)}_{ab} = \frac{1}{2}(\lambda^{ij}_{ac})^{(0)}(t^{bc}_{ij})^{(0)} + (\lambda^{i}_{a})^{(0)}(t^{b}_{i})^{(0)} \\
&D^{(1)}_{ab} = \frac{1}{2}[(\lambda^{ij}_{ac})^{(0)}(t^{bc}_{ij})^{(1)} + (\lambda^{ij}_{ac})^{(1)}(t^{bc}_{ij})^{(0)}] + [(\lambda^{i}_{a})^{(0)}(t^{b}_{i})^{(1)} + (\lambda^{i}_{a})^{(1)}(t^{b}_{i})^{(0)}] \\
&D^{(2)}_{ab} = \frac{1}{2}[{(\lambda^{ij}_{ac}})^{(1)}(t^{bc}_{ij})^{(1)} + (\lambda^{ij}_{ac})^{(0)}(t^{bc}_{ij})^{(2)}]
\ + [(\lambda^{i}_{a})^{(1)} (t^{b}_{i})^{(1)} + (\lambda^{i}_{a})^{(0)}(t^{b}_{i})^{(2)}]\\
%\end{multline}
\end{split}
\end{equation}
In the above equation, the indices $i,j$ and $a,b,c$ refer to occupied and virtual orbitals respectively
and Einstein summation notation is used. The first order perturbed amplitudes $(\lambda^{ij}_{ac})^{(1)}$ 
and $(t^{bc}_{ij})^{(1)}$ are nothing but the $\hat{X}^{B}_{\omega_1}$ and $\hat{Y}^{B}_{\omega_1}$ 
amplitudes that we saw earlier.\\ Just as the ground state MP2 density can transfer its knowledge of 
electron correlation effects to the one electron basis (virtual NOs) through diagonalization, 
the perturbed densities can be used in a similar way to construct a compact ``perturbation aware''
basis. In our earlier work, we used a guess first-order perturbed density constructed from MP2 amplitudes
to obtain our virtual space but this approach offered only a minor improvement\cite{}.
To investigate the reason behind the failure of this model, we constructed the virtual-virtual
block of the full CCSD first-order perturbed density. All the diagonal elements of this density 
matrix were found to be zeros irrespective of the perturbation operator. The exact reason for this
is not yet understood but clearly, the NOs obtained from this (or guess) density doesn't carry any useful
information. However, since the polarizabilities are second-order in perturbation, second-order perturbed densities 
should in principle be a better metric for estimating the importance of a virtual NO for these properties.
In this paper, we use second-order guess densities to define our virtual space for correlated response calculations.
For a perurbation operator A,
\begin{equation}
{D^{'}(A)}^{(2)}_{ab} = \frac{1}{2}(t^{ac}_{ij}(A))^{(1)}(t^{bc}_{ij}(A))^{(1)} + (t^{a}_{i}(A))^{(1)} (t^{b}_{i}(A))^{(1)}, 
\end{equation}
where,
\begin{equation}
\begin{split}
& t^{ac}_{ij}(A)^{(1)} = \frac{-\bar{A}^{ac}_{ij}}{\epsilon_i + \epsilon_j - \epsilon_a - \epsilon_c},\\
& t^{a}_{i}(A)^{(1)} = \frac{-\bar{A}^{a}_{i}}{\epsilon_i - \epsilon_a}\\
\end{split}
\end{equation}
Here, we have used MP2 amplitudes for the similarity transformation, i.e. 
\begin{equation}
\bar{A}^{ac}_{ij} = P_{ij}^{ac}(t^{ec}_{ij}A^a_e - t^{ac}_{mj}A^m_i) ,
\end{equation}
ignored the terms involving second-order perturbed amplitudes and 
approximated the first-order perturbed $\lambda$ amplitudes by the 
corresponding $t$ amplitudes. The first-order right-hand perturbed
amplitudes in CC linear response theory can be expressed as, 
\begin{equation}
\begin{split}
& t^{ac}_{ij}(A)^{(1)}(\omega_1) = - \langle\Phi_{ij}^{ac}| {(\bar{H} -\omega_1 I)}^{-1} |
\Phi_{k\ldots}^{d\ldots}\rangle \langle \Phi_{k\ldots}^{d\ldots}| \bar{A} | \Phi_0\rangle, \\
& t^{a}_{i}(A)^{(1)}(\omega_1) = - \langle\Phi_{i}^{a}| {(\bar{H} -\omega_1 I)}^{-1} |
\Phi_{k\ldots}^{d\ldots}\rangle \langle \Phi_{k\ldots}^{d\ldots}| \bar{A} | \Phi_0\rangle \\
\end{split}
\end{equation}
It can be clearly seen that the guesses for $t^{ac}_{ij}(A)^{(1)}$ and 
$t^{a}_{i}(A)^{(1)}$ amplitudes in this work have been chosen by 
only considering the diagonal elements of $(\bar{H} -\omega_1 I)^{-1}$
which can be justified due to the diagonally dominant nature of the
$\bar{H}$ matrix. Furthermore, we keep $\omega_1$ as zero as we 
want to use the same density matrix for a given property calculation at different
frequencies. We also assume that removing $\omega_1$ should not significantly change the 
sparsity pattern of the perturbed amplitudes. 
\section{Computational Details}
1. primary application : optical rotation of solvated molecular clusters. But for pilot studies,
   (for the right behavior or tend)
   we chose chiral test cases - $h_2o_2$, linear (H2)n helices, phenylethanol, betapinene
   norbornenone 
2. properties - dynamic polarizabilities 
   and specific rotation. Polarizabilities mostly as a diagnostic tool
   because even though its linear response function is quite similar in structure
   to optical rotation, it is less sensitive to the truncation of the wavefunction.
  for polarizabilities - second-order guess densities based on a) elctric dipole,
  for specific rotation - b) magnetic dipole and c) both electric and magnetic dipoles
3. CC2 and CCSD method  - length and MVG - aug-cc-pvdz basis
4. sparsity plots of large solvated clusters (since we can't do full calculations 
	right now!) using densities constructed using density-fitting.
5. Psi4 and Psi4Numpy software used!
6. We have used the same virtual space for calculating both unperturbed and 
perturbed amplitudes as this ensures a match with results obtained 
from finite-field procedures.

%The r test cases of this work is hydrogen peroxide,
%H$_2$O$_2$, though additional tests are reported for related species such as
%(\textit{P})-dimethylallene and (\textit{S})-methyloxirane, as well as those
%same molecules interacting with one or more water molecules.  All molecular
%structures were optimized using the B3LYP
%functional\cite{Becke93,Stephens94:B3LYP,Lee88:LYP} in the aug-cc-pVDZ (aDZ)
%basis.\cite{Dunning89,Kendall92,Woon94} (Coordinates of all structures are
%provided in Tables S1-S5 of the Supporting Information.) Frequency-dependent
%polarizabilities were computed at the coupled cluster singles and doubles
%(CCSD) level of theory\cite{Purvis82} using a linear-response
%formulation.\cite{Christiansen98} While the aDZ basis set was used for most
%test calculations, the larger aug-cc-pVTZ (aTZ) and aug-cc-pVQZ (aQZ) basis
%sets were also employed for selected analyses.\cite{Kendall92} All orbitals
%were active in the correlated models utilized here, and all coupled-cluster
%calculations were carried out using the PSI4 open-source quantum chemistry
%package.\cite{psi4}  In all calculations in which virtual orbitals are
%truncated, the same orbital space is used in the solution of the unperturbed
%and perturbed amplitudes equations, just as is required for locally correlated
%property calculations.\cite{Crawford10}  We note that the size-extensivity of
%the polarizability is unaffected by the truncation of
%the virtual space.
%
\section{Results and Discussion}
Retention of diffuse space: Sort all the canonical MOs by their spatial
extents <i|r*r|i>, choose a cutoff, retain all the orbitals above that cutoff
and apply the regular FVNO in the remaining virtual space. As an example
for h2o2 in aug-cc-pvdz basis., we retained 26 out of 55 most diffuse virtual 
CMOs, constructed MP2 ground state density in the remaining space of 
29 virtual orbitals. Fig.1 compares the performance of this method 
with the regular FVNO approach for calculating CCSD dynamic polarizabilities
and specific rotation at 589 nm. Explain the trend - minimal errors. Similar
errors can be expected for a lot of chiral molecules who like h2o2 possess 
low lying Rydberg states. However, such a simplified approach could mean 
retaining a lot of diffuse virtual orbitals which might not be feasible 
for large-scale calculations. Moreover, the metric of retention might
be not well-defined. Thus, we instead look at the performance
of the second-order perturbed density approach which we have named as FVNO++ 
in the next sections.
\subsection{$(H_2)_n$ Helices}
- Linear structure, chiral, helical arrangement
- best case for local correlation problems
- small masses, high OR
- Polariz, specific rotation (h2)4, (h2)5, (h2)6, (h2)7, maybe-bigger!! : LG, MVG, aDZ basis
- diagnostics for FVNO++ approach:
	- first comparing the structure of the ground state and perturbed density, one can see 
	  that perturbed density would have a higher rank than ground-state density.
	- how about incorporating L*L density as well and optimized NOs by better guess densities.
	- Here we mostly concentrate on capturing the right kind of behavior rather 
  	than savings, since there is not enough sparsity on offer for these cases.
  	This is applicable for other test cases as well.
\subsection{beta-pinene}
\subsection{phenyl-ethanol}
\subsection{norbornenone}
Maybe bring MP2 diagnostics here as a reason for poor behavior! I mean here the pi-pi*
excitations might require accurate T2 amplitudes as well.
\subsection{Sparsity in solvated cluster}

%It is well known that deletion of higher-energy canonical Hartree-Fock MOs
%(CMOs) typically leads to significant errors in the recovery of electron
%correlation energies, whereas, by design, the truncation of virtual NOs with
%low occupation numbers results in little loss of accuracy.\cite{Landau10,Taube05,Taube08}
%For example, Fig.~\ref{fig:energy} plots the error in
%the CCSD correlation energy of H$_2$O$_2$ in the aDZ basis as a function of
%the number of frozen virtual CMOs (removed starting from the highest energy
%orbitals) or NOs (starting from the lowest occupation numbers).  Clearly the
%correlation energy is very sensitive towards the removal of CMOs, with the
%error increasing by more than 4 kcal/mol after the deletion of even one
%virtual orbital.  On the other hand, removal of low occupation-number NOs
%introduces errors of only ca.\ 2.5 kcal/mol even when up to 33\% of the
%virtual space (18 of 55 orbitals) is truncated.  The errors in
%the NO basis can be further minimized by employing an MP2 energy correction,
%\begin{equation}
%E^{\rm MP2}_{\rm corr} = \frac{1}{4} \sum_{ij} \sum_{ab \in {\rm ext}} \frac{|\langle
%ij||ab\rangle|^2}{\epsilon_i + \epsilon_j - \epsilon_a - \epsilon_b}.
%\label{Eq:MP2}
%\end{equation}
%where the summation over virtual orbitals is limited to NOs in the external,
%truncated space.  Fig.~\ref{fig:MP2_corr} plots the error in the CCSD
%correlation energy for the same system as above in the NO basis, with and
%without this correction (left-hand vertical axis), as well as the correction
%itself (right-hand axis).  After employing the correction, the error in the
%correlation energy falls to less than 0.1 kcal/mol when 1/3 of the virtual
%space is eliminated. Similar results are obtained for aTZ and aQZ basis sets,
%where the truncation errors are less than 1 kcal/mol even after the removal of 50\%
%of the virtual space. We note that the MP2 energy correction is significant 
%(on the order of m$E_h$ or several kcal/mol) even for small compounds such as 
%H$_2$O$_2$.  The correction scales linearly with the number of electrons and 
%thus is a critical component for the success of the frozen virtual NO approach 
%for larger molecules.
%
%\subsection{Frozen Virtual Orbitals and Response Properties}
%
%What is the impact of freezing virtual orbitals --- whether CMO or NO --- on
%higher-order properties?  Fig.\ \ref{fig:polar_h2o2} plots errors in dynamic
%polarizabilites (computed at a wavelength of 589 nm) as a function of the
%number of virtual orbitals deleted at the CCSD/aDZ level of theory for the
%same H$_2$O$_2$ test case as above.  Comparison to Fig.\ \ref{fig:energy}
%reveals precisely the opposite behavior for polarizabilities as for
%correlation energies, {\em viz.}, truncation of the CMO virtual space induces
%much smaller errors than does that of the NO virtual space.  For the latter,
%errors increase approximately linearly with the number of frozen virtual NOs.
%On the other hand, for the CMO basis, the error increases slowly to a maximum
%of 1.9\% when 13 virtual orbitals are removed and then decreases to only
%-0.3\% when as many as 27 orbitals (ca.\ 50\% of the virtual space) are
%frozen.  This trend is not unique to H$_2$O$_2$ or the aDZ basis set. As shown
%in Fig.~S1 of the Supporting Information, the same behavior is observed for
%other molecules such as dimethylallene, methyloxirane, and such compounds
%interacting with explicit solvent molecules.  In addition, Figs.~S2 and S3
%report the same trends for H$_2$O$_2$ with the larger aTZ and aQZ basis sets.
%
%
%What is the source of this unexpected behavior?  It is well known that diffuse
%basis sets are essential for the accurate descriptions of a variety of
%response properties, such as dipole polarizabilities.\cite{Woon94}  Fig.~\ref{fig:spatial}
%plots the spatial extent --- $\langle r^2 \rangle$ --- for each virtual CMO or
%NO in the same ordering as they are deleted in Fig.~\ref{fig:polar_h2o2}.  The
%Figure clearly shows that the earliest NOs to be removed (the ones with the
%lowest occupation numbers) are the most diffuse, {\em i.e.}, they should
%contribute substantially to the description of the dynamic polarizability.  On
%the other hand, the first CMOs to be frozen (those with the highest orbital
%energies) are also the most compact and thus contribute the least to this
%property.  Given that highly diffuse basis functions typically contribute
%primarily to CMOs with low orbital energies --- often below that of what is
%normally considered the true anti-bonding ``LUMO'' --- the latter result is
%not surprising; these diffuse CMOs appear to the far right of
%Fig.~\ref{fig:spatial} and are thus never deleted, leading to the good
%behavior of the CMO truncation in Fig.~\ref{fig:polar_h2o2}.  These same
%diffuse basis functions, however, contribute little to the description of
%dynamical correlation effects, and thus exhibit very low occupation numbers
%upon transformation to the NO virtual space.  Thus, they are truncated first
%in the NO basis, yielding the large errors in the polarizability depicted in
%Fig.~\ref{fig:polar_h2o2}.
%
%The above observations suggest that, for computing response properties such as
%dynamic polarizabilities, an alternative approach to truncation of the virtual
%space is to order the orbitals by increasing values of $\langle r^2 \rangle$
%rather than by decreasing orbital energies (as is done for CMOs) or increasing
%occupation numbers (for NOs).  Fig.~\ref{fig:sort_spatial} plots errors in the
%CCSD/aDZ dynamic polarizability of H$_2$O$_2$ as the virtual CMOs or NOs are
%removed in order of increasing spatial extent.  While the errors are
%comparable to that observed in Fig.~\ref{fig:polar_h2o2} for the CMO
%truncation, the behavior associated with removal of virtual NOs is
%significantly different.  First, the polarizability errors exhibit two
%plateaus: one associated with diffuse NOs 2-5 and another with NOs 16-30, and
%removal of these NOs has little impact on the observed error.  However,
%deletion of the virtual NO with the {\em smallest} spatial extent unexpectedly
%leads to a large initial error (ca.\ 7.5 a.u.), followed later by a linearly
%increasing error as virtual NOs 6-15 are removed.  Clearly, spatial extent is
%not the only criterion by which we may predict the importance of a given
%virtual NO to the polarizability.
%
%Another possible source of error is the lack of orbital response in the chosen
%formulation of the coupled cluster linear response function.\cite{Koch94:BCC}
%In the infinite-lifetime approximation, frequency-dependent properties such as
%dipole polarizabilities exhibit first-order poles at the excitation
%frequencies.  In the coupled cluster formulation described above, the orbital
%response to the external field is typically neglected so that these poles
%correspond solely to the response for the correlated wave function, and
%additional, spurious poles arising due to the Hartree-Fock reference
%determinant will not appear.  (This approximation is typically justified based
%on the fact that much of the orbital-response effects are accounted for by the
%singles amplitudes.\cite{Christiansen95:CC2})  In order to test whether the
%orbital relaxation significantly impacts the behavior of the computed
%polarizability as the virtual space is reduced, we have computed {\em static}
%($\omega = 0.0$) polarizabilities using finite-differences (with a a
%central-difference formula with a differential field strength of 0.001 a.u.)
%The errors in the CCSD/aDZ static polarizability of H$_2$O$_2$ for both CMO
%and NO virtual spaces are reported in Fig.~\ref{fig:static}.  Interestingly,
%with orbital relaxation included, the truncation of the NO space now becomes
%better behaved than the CMO space over a large domain of orbitals removed.
%Unfortunately, we cannot take advantage of this improvement in conjunction
%with Hartree-Fock orbitals without corrupting the pole structure of the
%response function.  A Brueckner or orbital-optimized approach may prove
%superior in this regard, though further investigation is
%warranted.\cite{Koch94:BCC,Pedersen01}
%
%\subsection{Wave Function Truncation in the Virtual-Orbital Space}
%
%For additional insight into the above observations, we examine errors arising
%in dynamic polarizabilities as a function of truncation of specific
%wavefunction parameters in either the CMO or NO basis.
%Fig.~\ref{fig:amp_trunc_cmo} plots the errors in CCSD/aDZ dynamic
%polarizabilities of H$_2$O$_2$ as a result of truncations of the unperturbed
%ground-state cluster amplitudes $\hat{T}$ and $\hat{\Lambda}$, as well as
%perturbed amplitudes, $\hat{X}_\omega^\mu$, represented in the CMO basis.
%Note that, in this analysis, only the specified amplitudes associated with the
%selected CMOs are forced to zero; the CMOs remain active for all other wave
%function components.  From the Figure, it can be clearly seen that removing
%$\hat{T}_1$ alone does not introduce any significant error in the
%polarizability, whereas truncating $\hat{T}_2$ amplitudes results in
%substantial positive errors which increase almost linearly with the number of
%virtual CMOs. (Not surprisingly, freezing both $\hat{T}_1$ and $\hat{T}_2$
%amplitudes together have essentially the same effect as freezing $\hat{T}_2$
%amplitudes alone.) Alternatively, for the left-hand wave function, removing
%$\hat{\Lambda}_1$ and $\hat{\Lambda}_2$ amplitudes either separately or
%pairwise seem to have negligible impact.  In the case of the perturbed
%amplitudes, only small (negative) errors are introduced even after freezing
%all $\hat{X}_1$ amplitudes involving almost 23 virtual CMOs, but the error
%then rises sharply with further truncation.  On the other hand, the negative
%errors due to truncation of $\hat{X}_2$ amplitudes are significant from the
%beginning and increase almost linearly.  Thus the error due to removal of both
%$\hat{X}_1$ and $\hat{X}_2$ amplitudes belonging to the first 23 CMOs is due
%to elimination of $\hat{X}_2$ amplitudes alone, whereas beyond that limit, the
%total error corresponds to the sum of errors from $\hat{X}_1$ and $\hat{X}_2$
%truncation.
%
%A key observation is that, within the domain of the first 23 virtual CMOs, the
%positive errors introduced by truncation of $\hat{T}_2$ is cancelled almost
%exactly by the negative errors arising from the truncation of $\hat{X}_2$.
%This is further illustrated in Fig.~\ref{fig:error_cmpare}, which plots on a
%narrow range the errors in the polarizability associated with truncating
%specific classes of $\hat{T}_2$ and $\hat{X}_2$ amplitudes against the total errors
%obtained by freezing CMOs entirely (for all amplitudes).  Outside of this
%domain, errors associated with neglect of $\hat{X}_1$ amplitudes become
%dominant, leading to the accumulation of negative total errors observed in
%Fig.~\ref{fig:polar_h2o2}.  Thus, the apparently robust performance of the
%truncation of the virtual CMO space arises, in fact, from offsetting
%errors.
%
%Similarly to the above analysis for the virtual CMO space,
%Fig.~\ref{fig:amp_trunc_no} reports errors in the CCSD/aDZ polarizability of
%H$_2$O$_2$ introduced by the neglect of various classes of wave function
%amplitudes associated with selected virtual NOs.  We observe first that,
%unlike the CMO case, neglecting $\hat{T}_2$ amplitudes associated with
%particular virtual NOs has no significant effect on the error.  This behavior
%is expected, because the $\hat{T}_2$ amplitudes are, by construction, sparse
%in the virtual NO basis such that orbitals with low occupation numbers are
%associated with $\hat{T}_2$ amplitudes of smaller magnitude.  Furthermore,
%just as in the CMO case, the removal of $\hat{T}_1$, $\hat{\Lambda}_1$ and
%$\hat{\Lambda}_2$ amplitudes introduces only small errors, while the removal
%of selected $\hat{X}_2$ amplitudes based on NOs yields significant negative
%errors that increase linearly with the number of virtual NOs truncated.
%
%However, unlike the virtual CMO case, neglecting $\hat{X}_1$ amplitudes
%corresponding to specific virtual NOs introduces large negative errors in the
%polarizability even from the first NO removed, and the total error obtained by
%truncating both $\hat{X}_1$ and $\hat{X}_2$ amplitudes is almost the same as
%the error due to truncation of the $\hat{X}_1$ amplitudes alone.  Indeed, 
%the greatest contribution ($>90\%$) to the
%total polarizability errors arises from the perturbed singles amplitudes.
%
%The significance of the $\hat{X}_1$ amplitudes is evident upon analysis of
%their leading-order contribution to the polarizability [cf.\
%Eq.~(\ref{Eq:alpha})],
%\begin{equation}
%\alpha_\omega \leftarrow \frac{1}{3} \sum\limits_{ia}\sum\limits_x \mu^{x}_{ia}(X^x_{ia}(\omega) +
%X^x_{ia}(-\omega)),
%\label{Eq:leading_X1}
%\end{equation} 
%where $\mu^x_{ia}$ is an element of the occupied-virtual block of the
%Cartesian component, $x$, of the electric-dipole moment integral matrix, and the inner
%sum runs over all such components. The singles
%themselves are obtained from the corresponding form of
%Eq.~(\ref{Eq:perturbed_wfn}),
%\begin{equation} 
%\langle\Psi^a_i|X^{\mu}_{\omega}|\Psi_0\rangle =
%-\sum_{\nu}\langle\Psi^a_i|(\bar{H} -
%\omega)^{-1}|\nu\rangle\langle\nu|\bar{\mu}|\Psi_0\rangle,
%\hspace{0.15in}\nu
%\in \{\Psi^b_j,\Psi^{cd}_{jk}\},
%\label{Eq:singles}
%\end{equation} 
%where $\bar{\mu}$ is the similarity transformed electric-dipole operator,
%\begin{equation}
%\bar{\mu} = \hat{\mu} + \bigg[\hat{\mu},\hat{T}\bigg] +
%\frac{1}{2}\bigg[\bigg[\hat{\mu},\hat{T}\bigg],\hat{T}\bigg].
%\label{Eq:mubar}
%\end{equation}
%The corresponding leading-order contribution to the $\hat{X}_1$ amplitudes themselves is
%\begin{equation}
%X^{\mu}_{ia}(\omega) \leftarrow \frac{\mu_{ia}}{\overbar{H}_{ii} -
%\overbar{H}_{aa} + \omega},
%\label{Eq:X1}
%\end{equation}
%where the largest contribution to the diagonal elements of the similarity
%transformed Hamiltonian, $\bar{H}$, arises from the orbital energies (more
%precisely, the diagonal Fock matrix elements expressed in the CMO or NO
%basis), which are plotted in Fig.~\ref{fig:Faa}.  While the values for the
%virtual CMOs decrease steadily, their NO counterparts actually {\em increase}
%and display greater oscillation.  Clearly, the diagonal elements of the fock
%matrix for virtual NOs are significantly smaller in magnitude than the
%corresponding CMOs, which concomitantly increases the values of the
%$\hat{X}_1$ amplitudes associated with such NOs.  This effect can be seen in
%Fig.~\ref{fig:X1} which plots the sum of the absolute values of $\hat{X_1}$
%amplitudes for a given virtual orbital, i.e.  $\sum_i |X_i^a|$, for both
%virtual CMOs and NOs.  Thus, the sparsity of the $\hat{X}_1$ amplitudes present in the
%CMO basis is almost completely lost in the NO basis, which leads to the large
%errors in dynamic polarizabilities due to the truncation of $\hat{X}_1$
%amplitudes in the NO basis observed earlier.  
%
%Furthermore, the dependence of the $\hat{X}_1$ amplitudes on both $\hat{T}_2$
%and $\hat{X}_2$ plays a significant role in the overall {\em sign} of the
%polarizability error.  This point is clearly illustrated in
%Fig.~\ref{fig:norm}, which plots the 2-norm of the $\hat{X}_1$ vector as
%$\hat{T}_2$ or $\hat{X}_2$ amplitudes associated with a given virtual CMO is
%neglected (in the same manner as used in Figs.~\ref{fig:amp_trunc_cmo} and
%\ref{fig:error_cmpare}). As the $\hat{T}_2$ amplitudes associated with a given
%virtual orbital are removed, the norm of the $\hat{X}_1$ vector
%increases, leading to the positive errors in the polarizability observed in
%Fig.~\ref{fig:amp_trunc_cmo}.  On the other hand, removal of $\hat{X}_2$
%amplitudes leads to a decrease in the norm of the $\hat{X}_1$ vector and
%the negative errors in the polarizability appearing in
%Fig.~\ref{fig:amp_trunc_cmo}.
%
%\subsection{External-Space Corrections}
%
%As noted earlier, a key aspect of the strong performance of virtual NOs for
%correlation energies is the use of MP2-based corrections for the contributions
%of the truncated or ``external'' virtual space, as given in
%Eq.~(\ref{Eq:MP2}).  When considering a similar correction for properties,
%however, we have explored three options: time-dependent Hartree-Fock (TDHF)
%and both static and dynamic CC2\cite{Christiansen95:CC2} corrections.  In each
%case, we have used the same MP2-based virtual NO space and computed the
%correction as the difference between the full-virtual space polarizability and
%the truncated virtual-NO polarizability, with the CCSD/aDZ results for
%polarizabilties of H$_2$O$_2$ shown in Fig.~\ref{fig:corrections}.
%
%The CC2-based corrections recover nearly all of the error associated with the
%uncorrected virtual NO space across a wide range of truncation, with the
%static correction actually yielding slightly smaller errors than its dynamic
%counterpart.  The less expensive TDHF corrections offer significant
%improvement over the original virtual NO results, and recover most (ca.\ 85\%)
%of the error until about 40\% (21 orbitals) of the virtual space has been
%deleted, but it clearly produces overall larger errors than the correlated
%methods.  In addition, the TDHF corrections are potentially problematic
%because the pole structure of the polarizability naturally follows that of the
%underlying Hartree-Fock perturbed orbitals rather than that of the correlated
%wave functions,\cite{Rice91,Hattig95,Aiga96} a criticism that would also hold
%for purely MP2-based corrections.  On the other hand, the CC2-based
%corrections are significantly more expensive than TDHF, in part because of
%their iterative nature and the
%need to transform two-electron integrals involving three virtual orbitals
%(with the latter criticism again holding for an MP2-based correction).
%
%\subsection{Perturbed Natural Orbitals}
%
%Given that the purpose of the NOs is to ``focus'' the important components of
%the basis for the description of electron correlation effects into a compact
%space, without consideration of the importance of the basis set for other
%properties, an alternative approach might be to build a virtual space that
%explicitly takes such properties into account, such as the inclusion of the
%perturbed one-electron density in the definition of the space.  Instead of
%diagonalizing the ground-state MP2 density, we diagonalize its gradient with
%respect to the external electric field, thereby incorporating the effects of
%the external perturbations.  The resulting ``occupation numbers'' obtained
%thus carry information about orbital occupancies in the perturbed states.  The
%$x^{th}$ Cartesian component of the perturbed density matrix can be written in
%terms of spin orbitals as
%\begin{equation}
%\gamma^x_{ab} = \frac{1}{2}\sum_{ijc}P_{+}(a,b)\left[\frac{t^{bc}_{ij}}{D^{ac}_{ij}}\left(P_{-}(a,c)\sum_dt^{ad}_{ij}\mu^x_{cd} - P_{-}(i,j)\sum_m t^{ac}_{im}\mu^x_{mj}\right)\right]
%\label{Eq:perturb_d}
%\end{equation}
%where $P_{+}$ and $P_{-}$ are symmetric and anti-symmetric permutation
%operators, respectively, and the orbital-energy denominator $D^{ac}_{ij} =
%\epsilon_i + \epsilon_j  -\epsilon_a -\epsilon_c $.  (For computational
%convenience, orbital relaxation terms have been neglected.) To obtain the
%perturbed NOs and their corresponding eigenvalues, we take an average of the
%three cartesian components of the density and diagonalize the result.
%The eigenvalues consist of both positive and negative values as the perturbed
%density matrix is not positive definite, and thus we truncate the orbitals
%based on the absolute values of these eigenvalues.
%
%Fig.~\ref{fig:perturb} compares the performance of these perturbed NOs with
%that of the CMOs and NOs, where the error in the CCSD/aDZ dynamic
%polarizability of H$_2$O$_2$ is plotted as a function of the number of virtual
%orbitals removed. While the perturbed NOs lower the truncation errors
%associated with conventional NOs, they still introduce significantly higher
%errors than the corresponding CMOs.  The reason for this underperformance is
%related to the definition of the perturbed density, which naturally bears
%strong similarity to its unperturbed counterpart [cf. Eqs.~(\ref{Eq:dens}) and
%(\ref{Eq:perturb_d}).]  As a result, similar sparsity and orbital energy issues
%illustrated in Figs.~\ref{fig:Faa} and \ref{fig:X1} arise for the perturbed
%density just as for the original NOs, indicating that such an approach does not
%resolve the problem.
%
%\subsection{The Dipole-Amplitude Criterion}
%
%The above results demonstrate that the CMO basis provides the best performance
%among the various virtual spaces considered here, albeit based on cancellation
%of errors, but what criterion should be used to determine the truncation level
%that provides optimal balance between computational cost (most compact virtual
%space) and accuracy?  The CMO orbital energies are one possibility, but they
%have no direct connection to the properties in question.  Another alternative
%is the ``dipole amplitude'', $d_a$, which is defined for each virtual CMO as
%\begin{equation}
%d_a \equiv \sum\limits_x\sum\limits_i\frac{({\mu^x_{ia}})^2}{\epsilon_i - \epsilon_a}.
%\label{Eq:dipole}
%\end{equation}
%This expression, which is trivially computed post-Hartree-Fock, is based on
%Eqs.~(\ref{Eq:leading_X1}) and (\ref{Eq:X1}), using the fact that the leading
%contributions to the diagonal elements of the similarty-transformed
%Hamiltonian are the orbital energies.    As we are constructing a
%phenomenological truncation criterion, we have chosen to neglect the
%dependence on the field frequency.
%
%Fig.~\ref{fig:dipole_length} plots the values of the dipole amplitude for
%each CMO, as well as the corresponding error in the CCSD/aDZ
%dipole-polarizability of H$_2$O$_2$ introduced by deleting the $\hat{X}_1$
%amplitude associated with a given virtual CMO. There is a clear correlation
%between the two functions, and one can see that as both the error due to
%truncation of $\hat{X}_1$ and the value of the dipole length increase sharply
%once we reach CMOs 27-28 --- ca. 50\% of the virtual space for this test case.
%Accordingly, one should stop the truncation of the virtual CMO space once the
%dipole length values start rising sharply.  While the optimal choice of
%such a threshold will be addressed systematically in subsequent work, our
%preliminary analyses using H$_2$O$_2$, methyloxirane, dimethylallene, and
%related compounds suggest a cutoff of ca.\ 3-3.5\% yields minimal errors
%in the polarizability.
%
\section{Conclusions}

- Within the FVNO++ formalism, explored 
structures of second-order perturbed densities:
Dab(2)(MU), Dab(2)(P), Dab(2)(MU,L), Dab2(P,L), Dab(2)(L) 
employing different guesses of first-order perturbed amplitudes.  
Based on plot studies on small systems, we can conclude that 
this approach works, has the right behavior/convergence properties.
however, as usual, specific rotation is more sensitive than
polarizabilities and requires bigger virtual spaces.
Real application is solvated clusters, where we conclude that
there is a lot of sparsity to take advantage of.
Thus, we are going to implement RI-CC2 linear response
in conjunction with the FVNO++ aproach.
Also, this could easily be extended to PNO aproaches for reduced scaling.

%
%On the basis of the above findings, we conclude that, in the absence of
%orbital relaxation, virtual NOs are not
%suited for higher-order property calculations such as dynamic
%polarizabilities, and that the occupation number is not an acceptable
%criterion for estimating the importance of a virtual orbital for such
%calculations.  Although the use of external space corrections based on CC2
%polarizabilities reduces the observed truncation errors, they are too
%relatively costly to be practical for large molecular systems.  Furthermore,
%the use of perturbed virtual NOs offers only slight improvement as compared to
%unperturbed virtual NOs.  CMOs, on the other hand, provide a much more stable
%mechanism for reducing the size of the virtual space --- with truncation of up
%to 50\% of the orbitals yielding shifts of less than 2\% as compared to
%full-space calculation -- but the source of their success lies in a
%significant cancellation of errors.  Although further systematic studies are
%needed, the dipole amplitude appears to provide a useful threshold for an {\em
%a priori} truncation of the CMO virtual space.
%
\section{Acknowledgements}
%
%This research was supported by a grant (CHE-1465149) from the U.S.\
%National Science Foundation. The authors acknowledge Advanced Research
%Computing at Virginia Tech for providing computational resources and
%technical support that have contributed to the results reported within this
%paper.

%\clearpage
%%\bibliographystyle{rsc}
%\bibliography{refs}
%
%\newpage
%
%\input{figures.tex}
%
%\end{document}
